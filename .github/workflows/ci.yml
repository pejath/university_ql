name: Workflow for Ruby code coverage
on: [push, pull_request]
jobs:
    run:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v3
            - name: Set up Ruby 3.0.2
              uses: ruby/setup-ruby@v1
              with:
                ruby-version: '3.0.2'
            - name: Install dependencies
              run: bundle install
            - name: Set up Database
              run: bundle exec rake db:create db:migrate RAILS_ENV=test
            - name: Run tests and collect coverage
              run: bundle exec rake
            - name: Upload coverage to Codecov
              uses: codecov/codecov-action@v3